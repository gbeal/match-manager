# Story 1.1: PWA Foundation Setup

## Status
Ready for Review

## Story

**As a** volunteer coach,
**I want** the Match Manager app to work offline and install on my phone like a native app,
**so that** I can rely on it during games regardless of field connectivity.

## Acceptance Criteria

1. Next.js 15 PWA configured with service worker for offline functionality
2. Web App Manifest enables installation on mobile devices with proper icons and branding
3. Application loads and displays basic interface without internet connectivity
4. Service worker caches critical app resources for offline access
5. PWA installation prompts appear on supported browsers after first visit
6. App maintains responsive design optimized for mobile portrait orientation

## Tasks / Subtasks

- [x] Configure Next.js 15 PWA foundation (AC: 1, 2, 4)
  - [x] Install PWA-related dependencies (@ducanh2912/next-pwa or similar)
  - [x] Configure next.config.js with PWA settings
  - [x] Set up service worker with caching strategies
  - [x] Configure workbox for automatic resource caching

- [x] Create Web App Manifest configuration (AC: 2, 5)
  - [x] Create manifest.ts file in src/app/ directory
  - [x] Configure PWA icons in various sizes (192x192, 512x512, apple-touch-icon)
  - [x] Set up proper manifest metadata (name, short_name, description, theme_color, background_color)
  - [x] Configure start_url and display mode for native app experience

- [x] Implement offline-first basic interface (AC: 3, 6)
  - [x] Create offline fallback page at src/app/offline/page.tsx
  - [x] Set up basic responsive layout in src/app/layout.tsx
  - [x] Configure Tailwind CSS v4 for mobile-first responsive design
  - [x] Implement network status detection and offline indicators

- [x] Set up PWA installation prompts (AC: 5)
  - [x] Create PWAInstallPrompt component in src/components/shared/PWAControls/
  - [x] Implement beforeinstallprompt event handling
  - [x] Add installation banner or button when appropriate
  - [x] Handle post-installation state management

- [x] Configure development and deployment for PWA (AC: 1, 4)
  - [x] Update CLAUDE.md with PWA development commands
  - [x] Configure build scripts for PWA optimization
  - [x] Set up development server with PWA testing capabilities
  - [x] Verify service worker functionality in development mode

- [x] Create basic PWA testing structure (AC: 1, 3, 4)
  - [x] Set up Jest configuration for PWA components testing
  - [x] Create basic component tests for offline functionality
  - [x] Set up Playwright configuration for PWA E2E testing
  - [x] Add offline functionality test cases

## Dev Notes

### Previous Story Insights
This is the first story in the project - no previous story insights available.

### PWA Shell Component Architecture
**[Source: architecture/components.md#PWA Shell Component]**
- ServiceWorkerManager - Controls service worker registration and updates
- OfflineStateProvider - Exposes online/offline status to other components
- PWAInstallPrompt - Manages app installation user experience
- Dependencies: Browser APIs (Service Worker, Web App Manifest, Network Information)
- Technology Stack: Next.js App Router, Service Worker API, Web App Manifest, React Context for offline state management

### File Locations
**[Source: architecture/unified-project-structure.md]**
- Main PWA application: `apps/web/src/app/`
- Root layout with PWA setup: `apps/web/src/app/layout.tsx`
- Web App Manifest config: `apps/web/src/app/manifest.ts`
- PWA controls components: `apps/web/src/components/shared/PWAControls/`
- Service worker: `apps/web/public/sw.js`
- PWA icons: `apps/web/public/icons/` (icon-192x192.png, icon-512x512.png, apple-touch-icon.png)
- Offline page: `apps/web/src/app/offline/page.tsx`
- PWA tests: `apps/web/tests/e2e/offline-functionality.spec.ts`

### Technical Stack Requirements
**[Source: architecture/tech-stack.md]**
- Frontend Framework: Next.js 15.x for PWA foundation & SSG
- Frontend Language: TypeScript 5.6+ for type-safe development
- UI Component Library: React 19.x with improved concurrent features
- CSS Framework: Tailwind CSS 4.x for responsive styling (already established)
- Build Tool: npm workspaces with Next.js built-in bundler (Turbo)
- Cache: Service Worker Cache API (browser native) for asset caching
- E2E Testing: Playwright for PWA testing with mobile capabilities

### PWA Configuration Requirements
**[Source: architecture/components.md#PWA Shell Component and unified-project-structure.md]**
- Service worker must cache critical app resources for offline access
- Web App Manifest must enable mobile device installation
- Responsive design must be optimized for mobile portrait orientation
- Installation prompts must appear after first visit on supported browsers
- Network status detection and offline state management required
- PWA must integrate with Next.js App Router architecture

### Critical Fullstack Rules to Follow
**[Source: architecture/coding-standards.md#Critical Fullstack Rules]**
- PWA Offline: All features must work offline-first with cloud sync as enhancement
- Touch Optimization: All interactive elements must have minimum 44px touch targets
- Type Sharing: Always define types in packages/shared and import from there
- State Updates: Never mutate state directly - use proper state management patterns

### Deployment Configuration
**[Source: architecture/deployment-architecture.md]**
- Platform: Vercel Edge Network
- Build Command: `npm run build:web`
- Output Directory: `apps/web/.next`
- CDN/Edge: Global edge deployment with automatic optimization

## Testing

### Testing Standards
**[Source: architecture/testing-strategy.md]**
- Test file location: `apps/web/tests/e2e/offline-functionality.spec.ts` for E2E PWA tests
- Testing frameworks: Playwright for E2E PWA testing with mobile capabilities, Jest + React Testing Library for component tests
- Specific testing requirements: PWA offline capabilities, mobile installation flow, service worker functionality
- Test organization follows the testing pyramid with E2E tests at the top level for PWA workflows

### PWA Testing Requirements
- Service worker registration and caching verification
- Offline functionality testing across different network conditions
- PWA installation flow testing on mobile browsers
- Responsive design verification for mobile portrait orientation
- Network status detection and offline indicator testing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-14 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
- No critical debug issues encountered during implementation
- Minor ESLint configuration adjustments required for Jest and script files
- PWA service worker generation successful via @ducanh2912/next-pwa

### Completion Notes List
- **PWA Foundation**: Successfully configured Next.js 15 with @ducanh2912/next-pwa plugin
- **Service Worker**: Automatic generation working correctly with workbox caching strategies
- **Manifest**: Web App Manifest implemented with proper PWA metadata and SVG icons
- **Offline Support**: Created offline fallback page and network status detection hooks
- **Installation**: PWA install prompt component handles beforeinstallprompt events
- **Testing**: Jest and Playwright configured for component and E2E testing
- **Mobile Optimization**: Tailwind CSS v4 configured with touch targets and safe areas
- **Build Validation**: All builds, linting, and tests pass successfully

### File List
**Created Files:**
- `next.config.ts` - Updated with PWA configuration
- `src/app/manifest.ts` - Web App Manifest configuration
- `src/app/layout.tsx` - Updated with PWA metadata and viewport settings
- `src/app/page.tsx` - Updated with PWA components integration
- `src/app/globals.css` - Updated with PWA mobile optimizations
- `src/app/offline/page.tsx` - Offline fallback page
- `src/hooks/useOfflineStatus.ts` - Network status detection hook
- `src/components/shared/PWAControls/OfflineIndicator.tsx` - Offline status indicator
- `src/components/shared/PWAControls/PWAInstallPrompt.tsx` - PWA installation prompt
- `src/components/shared/PWAControls/index.tsx` - Component exports
- `public/icons/icon-192x192.svg` - PWA icon (192x192)
- `public/icons/icon-512x512.svg` - PWA icon (512x512)
- `public/icons/apple-touch-icon.svg` - iOS home screen icon
- `public/icons/README.md` - Icon documentation
- `public/icons/icon.svg` - Base icon template
- `scripts/create-placeholder-icons.js` - Icon generation script
- `scripts/generate-icons.html` - HTML icon generator
- `jest.config.js` - Jest testing configuration
- `tests/setup/jest.setup.js` - Jest setup file
- `tests/setup/playwright.config.ts` - Playwright E2E test configuration
- `tests/components/basic.test.tsx` - Basic component tests
- `tests/e2e/offline-functionality.spec.ts` - PWA E2E tests
- `CLAUDE.md` - Updated with PWA development guidance

**Modified Files:**
- `package.json` - Added PWA dependencies and test scripts

## QA Results

*This section will be populated by the QA Agent after story completion*